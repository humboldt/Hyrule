$(document).on('turbolinks:load', function() {

//Function for commercial banner:  request a random JSON theme at /commercial and change
//banner content
var commercialBanner = $('.download-section');
if (commercialBanner.data('ajax') == true ) {
  $.ajax({
    url: "/commercial",
    context: commercialBanner,
    datatype: "json",
  }).done(function(response) {
    $('.image-overlay').css("background", response['image']);
    $('.image-overlay').css('position', 'absolute' );
    $('.image-overlay').css('background-size', 'cover' );
    $('.image-overlay').css('background-position', 'center center' );
    $('.image-overlay').css('background-repeat', 'no-repeat' );
    $('#theme-title').html(response['name']);
    $('#theme-descr').html(response['descr']);
  });
};



//Function for Slider : change image background on top of page banner
  var slideshow = $('.slideshow');
  if ( slideshow && slideshow.data("images") ) {
    //the data-images is an array of all image_url for this page
    var urls= slideshow.data("images");
  } else {
    //those are default generic image for homepage slider
    var urls = [
      "url(<%= asset_url("001.jpg") %>)", "url(<%= asset_url("002.jpg") %>)",
      "url(<%= asset_url("003.jpg") %>)", "url(<%= asset_url("004.jpg") %>)",
      "url(<%= asset_url("005.jpg") %>)", "url(<%= asset_url("006.jpg") %>)",
      "url(<%= asset_url("007.jpg") %>)", "url(<%= asset_url("008.jpg") %>)",
      "url(<%= asset_url("009.jpg") %>)", "url(<%= asset_url("010.jpg") %>)",
      "url(<%= asset_url("011.jpg") %>)", "url(<%= asset_url("012.jpg") %>)",
      "url(<%= asset_url("013.jpg") %>)", "url(<%= asset_url("014.jpg") %>)",
      "url(<%= asset_url("015.jpg") %>)", "url(<%= asset_url("016.jpg") %>)",
      "url(<%= asset_url("017.jpg") %>)", "url(<%= asset_url("018.jpg") %>)",
      "url(<%= asset_url("019.jpg") %>)", "url(<%= asset_url("020.jpg") %>)",
      "url(<%= asset_url("021.jpg") %>)", "url(<%= asset_url("022.jpg") %>)"
    ];
  };

  var introSlide = function() {
    index = Math.floor((Math.random() * urls.length));
    var url = urls[index];
    //should load image first
    slideshow.css('background', url );
    slideshow.css('position', 'absolute' );
    slideshow.css('background-size', 'cover' );
    slideshow.css('background-position', 'center center' );
    slideshow.css('background-repeat', 'no-repeat' );
    slideshow.fadeIn(1000, function() {
      setTimeout(function() {
        slideshow.fadeOut(2000, introSlide);
      }, 6000);
    });
  }
  introSlide();

}); //$ready function ending
